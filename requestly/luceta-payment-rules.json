{
  "appMode": "EXTENSION",
  "groups": [
    {
      "id": "luceta_payment_testing",
      "name": "Luceta Payment Testing Suite",
      "status": "Active",
      "objectType": "group"
    }
  ],
  "rules": [
    {
      "id": "mock_checkout_success",
      "name": "1. Mock Checkout Success",
      "description": "Returns mock successful checkout response for offline testing",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Response",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "/api/checkout"
          },
          "response": {
            "type": "static",
            "value": "{\n  \"success\": true,\n  \"checkout_url\": \"https://demo.dodopayments.com/checkout/mock_session_123\",\n  \"session_id\": \"mock_session_123\",\n  \"product\": {\n    \"id\": \"pdt_mock_001\",\n    \"name\": \"Pro Plan (DEMO)\",\n    \"price\": \"$99.00\",\n    \"category\": \"pro\"\n  },\n  \"demo_mode\": true,\n  \"message\": \"This is a mock response from Requestly\"\n}",
            "statusCode": "200"
          }
        }
      ]
    },
    {
      "id": "mock_webhook_events",
      "name": "2. Mock Webhook Events",
      "description": "Simulate Dodo Payments webhook events for testing",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Response",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "/api/webhooks/dodo"
          },
          "response": {
            "type": "static",
            "value": "{\n  \"success\": true,\n  \"event_id\": \"evt_mock_webhook_001\",\n  \"event_type\": \"payment.completed\",\n  \"message\": \"Mock webhook processed successfully\",\n  \"data\": {\n    \"payment_id\": \"pay_mock_123\",\n    \"amount\": 9900,\n    \"currency\": \"USD\",\n    \"customer_email\": \"demo@luceta.audio\"\n  }\n}",
            "statusCode": "200"
          }
        }
      ]
    },
    {
      "id": "redirect_to_local_mock",
      "name": "3. Redirect Dodo API to Local Mock",
      "description": "Redirect Dodo Payments API calls to local mock server for offline development",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Redirect",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "test.dodopayments.com"
          },
          "destination": "http://localhost:3001/mock-dodo"
        }
      ]
    },
    {
      "id": "payment_delay_simulator",
      "name": "4. Payment Delay Simulator (3s)",
      "description": "Add 3 second delay to checkout requests to test loading states",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Delay",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "/api/checkout"
          },
          "delay": "3000"
        }
      ]
    },
    {
      "id": "demo_mode_banner",
      "name": "5. Demo Mode Banner Injector",
      "description": "Inject a 'DEMO MODE' banner on the page for sales demos",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Script",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "localhost:3000"
          },
          "scripts": [
            {
              "codeType": "js",
              "type": "afterPageLoad",
              "value": "// Luceta Demo Mode Banner - Injected by Requestly\n(function() {\n  const banner = document.createElement('div');\n  banner.id = 'requestly-demo-banner';\n  banner.innerHTML = `\n    <div style=\"\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      background: linear-gradient(90deg, #156d95, #1e7ba8);\n      color: white;\n      padding: 8px 16px;\n      text-align: center;\n      font-family: system-ui, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      z-index: 99999;\n      box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n    \">\n      ðŸŽµ DEMO MODE - Payments are simulated via Requestly | \n      <span style=\"opacity: 0.8\">No real transactions</span>\n    </div>\n  `;\n  document.body.prepend(banner);\n  \n  // Add padding to body to prevent content overlap\n  document.body.style.paddingTop = '40px';\n  \n  console.log('[Requestly] Demo Mode Banner injected');\n})();"
            }
          ]
        }
      ]
    },
    {
      "id": "chaos_mode_random_failures",
      "name": "6. Chaos Mode - Random Payment Failures",
      "description": "Randomly fail 30% of checkout requests to test error handling",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Response",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "/api/checkout"
          },
          "response": {
            "type": "code",
            "value": "function modifyResponse(args) {\n  const shouldFail = Math.random() < 0.3; // 30% failure rate\n  \n  if (shouldFail) {\n    return {\n      body: JSON.stringify({\n        success: false,\n        error: 'Payment gateway temporarily unavailable',\n        error_code: 'CHAOS_MODE_FAILURE',\n        message: 'This is a simulated failure from Requestly Chaos Mode',\n        retry_after: 5\n      }),\n      statusCode: 503\n    };\n  }\n  \n  // Let the original request through\n  return {};\n}"
          }
        }
      ]
    },
    {
      "id": "modify_headers_test_mode",
      "name": "7. Add Test Mode Headers",
      "description": "Add custom headers to identify test mode requests",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Headers",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Contains",
            "value": "/api/"
          },
          "modifications": {
            "Request": [
              {
                "type": "Add",
                "header": "X-Luceta-Test-Mode",
                "value": "true"
              },
              {
                "type": "Add",
                "header": "X-Requestly-Enabled",
                "value": "payment-testing"
              }
            ]
          }
        }
      ]
    },
    {
      "id": "mock_different_products",
      "name": "8. Mock Product Variants (Regex)",
      "description": "Return different mock responses based on product ID using regex",
      "status": "Inactive",
      "groupId": "luceta_payment_testing",
      "objectType": "rule",
      "ruleType": "Response",
      "pairs": [
        {
          "source": {
            "key": "Url",
            "operator": "Matches",
            "value": "/api/checkout.*product_id.*starter"
          },
          "response": {
            "type": "static",
            "value": "{\n  \"success\": true,\n  \"checkout_url\": \"https://demo.dodopayments.com/checkout/starter_mock\",\n  \"session_id\": \"starter_session_001\",\n  \"product\": {\n    \"id\": \"pdt_starter\",\n    \"name\": \"Starter Plan (MOCK)\",\n    \"price\": \"$29.00\",\n    \"category\": \"starter\"\n  },\n  \"discount_applied\": false\n}",
            "statusCode": "200"
          }
        },
        {
          "source": {
            "key": "Url",
            "operator": "Matches",
            "value": "/api/checkout.*product_id.*enterprise"
          },
          "response": {
            "type": "static",
            "value": "{\n  \"success\": true,\n  \"checkout_url\": \"https://demo.dodopayments.com/checkout/enterprise_mock\",\n  \"session_id\": \"enterprise_session_001\",\n  \"product\": {\n    \"id\": \"pdt_enterprise\",\n    \"name\": \"Enterprise Plan (MOCK)\",\n    \"price\": \"$299.00\",\n    \"category\": \"enterprise\",\n    \"features\": [\"Dedicated Support\", \"Custom Templates\", \"Unlimited Usage\"]\n  },\n  \"discount_applied\": true,\n  \"discount_percent\": 10\n}",
            "statusCode": "200"
          }
        }
      ]
    }
  ]
}
